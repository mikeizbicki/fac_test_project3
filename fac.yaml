# variables that are used in dependencies but not in the target will trigger a build of the dependency
# all of the files that match the target will be included in the dependencies

"outline.json":
  cmd: cp basic.json outline.json
  dependencies:
    - basic.json
    - deps/a
    - deps/b

"resources/$RESOURCE/about.json":
  cmd: cp basic.json resources/$RESOURCE/about.json
  dependencies:
    - basic.json
    - outline.json
    - resources/$RESOURCE/description.md
  variables:
    RESOURCE:
      ls resources

"sub$LEVEL1/outline.json":
  cmd: |
    cp basic.json sub$LEVEL1/outline.json
  dependencies:
    - outline.json
    - resources/$RESOURCE/about.json
    # NOTE:
    # the above will expand to
    # resources/a/about.json
    # resources/b/about.json
  variables:
    LEVEL1:
      jq -r 'range(0; .sections | length)' outline.json

"sub$LEVEL1/sub$LEVEL2/outline.json":
  cmd: |
    cp basic.json sub$LEVEL1/sub$LEVEL2/outline.json
  dependencies:
    - outline.json
    - sub$LEVEL1/outline.json
  variables:
    LEVEL1: |
      jq -r 'range(0; .sections | length)' outline.json
    LEVEL2: |
      jq -r "range(0; [.sections | length, $(($LEVEL1 + 1))] | min )" sub$LEVEL1/outline.json

"final.txt":
  cmd: |
    echo hello > "final.txt"
  dependencies:
    - sub$LEVEL1/sub$LEVEL2/outline.json
